import { useState, useMemo } from "react";
import { Dialog, DialogContent, DialogHeader, DialogTitle } from "@/components/ui/dialog";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Search, X } from "lucide-react";
import { cn } from "@/lib/utils";

// Comprehensive emoji data organized by categories
const EMOJI_CATEGORIES = {
  "Smileys & People": [
    "ðŸ˜€", "ðŸ˜ƒ", "ðŸ˜„", "ðŸ˜", "ðŸ˜†", "ðŸ˜…", "ðŸ¤£", "ðŸ˜‚", "ðŸ™‚", "ðŸ™ƒ", "ðŸ˜‰", "ðŸ˜Š", "ðŸ˜‡", "ðŸ¥°", "ðŸ˜", "ðŸ¤©",
    "ðŸ˜˜", "ðŸ˜—", "â˜ºï¸", "ðŸ˜š", "ðŸ˜™", "ðŸ¥²", "ðŸ˜‹", "ðŸ˜›", "ðŸ˜œ", "ðŸ¤ª", "ðŸ˜", "ðŸ¤‘", "ðŸ¤—", "ðŸ¤­", "ðŸ¤«", "ðŸ¤”",
    "ðŸ¤", "ðŸ¤¨", "ðŸ˜", "ðŸ˜‘", "ðŸ˜¶", "ðŸ˜", "ðŸ˜’", "ðŸ™„", "ðŸ˜¬", "ðŸ¤¥", "ðŸ˜”", "ðŸ˜ª", "ðŸ¤¤", "ðŸ˜´", "ðŸ˜·", "ðŸ¤’",
    "ðŸ¤•", "ðŸ¤¢", "ðŸ¤®", "ðŸ¤§", "ðŸ¥µ", "ðŸ¥¶", "ðŸ¥´", "ðŸ˜µ", "ðŸ¤¯", "ðŸ¤ ", "ðŸ¥³", "ðŸ¥¸", "ðŸ˜Ž", "ðŸ¤“", "ðŸ§", "ðŸ˜•",
    "ðŸ˜Ÿ", "ðŸ™", "â˜¹ï¸", "ðŸ˜®", "ðŸ˜¯", "ðŸ˜²", "ðŸ˜³", "ðŸ¥º", "ðŸ˜¦", "ðŸ˜§", "ðŸ˜¨", "ðŸ˜°", "ðŸ˜¥", "ðŸ˜¢", "ðŸ˜­", "ðŸ˜±",
    "ðŸ˜–", "ðŸ˜£", "ðŸ˜ž", "ðŸ˜“", "ðŸ˜©", "ðŸ˜«", "ðŸ¥±", "ðŸ˜¤", "ðŸ˜¡", "ðŸ˜ ", "ðŸ¤¬", "ðŸ˜ˆ", "ðŸ‘¿", "ðŸ’€", "â˜ ï¸", "ðŸ’©"
  ],
  "Nature": [
    "ðŸ¶", "ðŸ±", "ðŸ­", "ðŸ¹", "ðŸ°", "ðŸ¦Š", "ðŸ»", "ðŸ¼", "ðŸ¨", "ðŸ¯", "ðŸ¦", "ðŸ®", "ðŸ·", "ðŸ½", "ðŸ¸", "ðŸµ",
    "ðŸ™ˆ", "ðŸ™‰", "ðŸ™Š", "ðŸ’", "ðŸ”", "ðŸ§", "ðŸ¦", "ðŸ¤", "ðŸ£", "ðŸ¥", "ðŸ¦†", "ðŸ¦…", "ðŸ¦‰", "ðŸ¦‡", "ðŸº", "ðŸ—",
    "ðŸ´", "ðŸ¦„", "ðŸ", "ðŸ›", "ðŸ¦‹", "ðŸŒ", "ðŸž", "ðŸœ", "ðŸª²", "ðŸ¦—", "ðŸ•·ï¸", "ðŸ•¸ï¸", "ðŸ¦‚", "ðŸ¢", "ðŸ", "ðŸ¦Ž",
    "ðŸ¦–", "ðŸ¦•", "ðŸ™", "ðŸ¦‘", "ðŸ¦", "ðŸ¦ž", "ðŸ¦€", "ðŸ¡", "ðŸ ", "ðŸŸ", "ðŸ¬", "ðŸ³", "ðŸ‹", "ðŸ¦ˆ", "ðŸŠ", "ðŸ…",
    "ðŸ†", "ðŸ¦“", "ðŸ¦", "ðŸ¦§", "ðŸ˜", "ðŸ¦›", "ðŸ¦", "ðŸª", "ðŸ«", "ðŸ¦’", "ðŸ¦˜", "ðŸƒ", "ðŸ‚", "ðŸ„", "ðŸŽ", "ðŸ–"
  ],
  "Food & Drink": [
    "ðŸ‡", "ðŸˆ", "ðŸ‰", "ðŸŠ", "ðŸ‹", "ðŸŒ", "ðŸ", "ðŸ¥­", "ðŸŽ", "ðŸ", "ðŸ", "ðŸ‘", "ðŸ’", "ðŸ“", "ðŸ«", "ðŸ¥",
    "ðŸ…", "ðŸ«’", "ðŸ¥¥", "ðŸ¥‘", "ðŸ†", "ðŸ¥”", "ðŸ¥•", "ðŸŒ½", "ðŸŒ¶ï¸", "ðŸ«‘", "ðŸ¥’", "ðŸ¥¬", "ðŸ¥¦", "ðŸ§„", "ðŸ§…", "ðŸ„",
    "ðŸ¥œ", "ðŸŒ°", "ðŸž", "ðŸ¥", "ðŸ¥–", "ðŸ«“", "ðŸ¥¨", "ðŸ¥¯", "ðŸ¥ž", "ðŸ§‡", "ðŸ§€", "ðŸ–", "ðŸ—", "ðŸ¥©", "ðŸ¥“", "ðŸ”",
    "ðŸŸ", "ðŸ•", "ðŸŒ­", "ðŸ¥ª", "ðŸŒ®", "ðŸŒ¯", "ðŸ«”", "ðŸ¥™", "ðŸ§†", "ðŸ¥š", "ðŸ³", "ðŸ¥˜", "ðŸ²", "ðŸ«•", "ðŸ¥£", "ðŸ¥—",
    "ðŸ¿", "ðŸ§ˆ", "ðŸ§‚", "ðŸ¥«", "ðŸ±", "ðŸ˜", "ðŸ™", "ðŸš", "ðŸ›", "ðŸœ", "ðŸ", "ðŸ ", "ðŸ¢", "ðŸ£", "ðŸ¤", "ðŸ¥"
  ],
  "Activities": [
    "âš½", "ðŸ€", "ðŸˆ", "âš¾", "ðŸ¥Ž", "ðŸŽ¾", "ðŸ", "ðŸ‰", "ðŸ¥", "ðŸŽ±", "ðŸª€", "ðŸ“", "ðŸ¸", "ðŸ’", "ðŸ‘", "ðŸ¥",
    "ðŸ", "ðŸªƒ", "ðŸ¥…", "â›³", "ðŸª", "ðŸ¹", "ðŸŽ£", "ðŸ¤¿", "ðŸ¥Š", "ðŸ¥‹", "ðŸŽ½", "ðŸ›¹", "ðŸ›·", "â›¸ï¸", "ðŸ¥Œ", "ðŸŽ¿",
    "â›·ï¸", "ðŸ‚", "ðŸª‚", "ðŸ‹ï¸", "ðŸ¤¼", "ðŸ¤¸", "â›¹ï¸", "ðŸ¤º", "ðŸ¤¾", "ðŸŒï¸", "ðŸ‡", "ðŸ§˜", "ðŸ„", "ðŸŠ", "ðŸ¤½", "ðŸš£",
    "ðŸ§—", "ðŸšµ", "ðŸš´", "ðŸ†", "ðŸ¥‡", "ðŸ¥ˆ", "ðŸ¥‰", "ðŸ…", "ðŸŽ–ï¸", "ðŸµï¸", "ðŸŽ—ï¸", "ðŸŽ«", "ðŸŽŸï¸", "ðŸŽª", "ðŸ¤¹", "ðŸŽ­",
    "ðŸ©°", "ðŸŽ¨", "ðŸŽ¬", "ðŸŽ¤", "ðŸŽ§", "ðŸŽ¼", "ðŸŽµ", "ðŸŽ¶", "ðŸ¥", "ðŸª˜", "ðŸŽ¹", "ðŸŽ·", "ðŸŽº", "ðŸª—", "ðŸŽ¸", "ðŸª•"
  ],
  "Travel & Places": [
    "ðŸš—", "ðŸš•", "ðŸš™", "ðŸšŒ", "ðŸšŽ", "ðŸŽï¸", "ðŸš“", "ðŸš‘", "ðŸš’", "ðŸš", "ðŸ›»", "ðŸšš", "ðŸš›", "ðŸšœ", "ðŸï¸", "ðŸ›µ",
    "ðŸš²", "ðŸ›´", "ðŸ›¹", "ðŸ›¼", "ðŸš", "ðŸ›¸", "âœˆï¸", "ðŸ›©ï¸", "ðŸª‚", "â›µ", "ðŸš¤", "ðŸ›¥ï¸", "ðŸ›³ï¸", "â›´ï¸", "ðŸš¢", "âš“",
    "â›½", "ðŸš§", "ðŸš¨", "ðŸš¥", "ðŸš¦", "ðŸ›‘", "ðŸš", "ðŸ—ºï¸", "ðŸ—¿", "ðŸ—½", "ðŸ—¼", "ðŸ°", "ðŸ¯", "ðŸŸï¸", "ðŸŽ¡", "ðŸŽ¢",
    "ðŸŽ ", "â›²", "â›±ï¸", "ðŸ–ï¸", "ðŸï¸", "ðŸœï¸", "ðŸŒ‹", "â›°ï¸", "ðŸ”ï¸", "ðŸ—»", "ðŸ•ï¸", "â›º", "ðŸ›–", "ðŸ ", "ðŸ¡", "ðŸ˜ï¸",
    "ðŸšï¸", "ðŸ—ï¸", "ðŸ­", "ðŸ¢", "ðŸ¬", "ðŸ£", "ðŸ¤", "ðŸ¥", "ðŸ¦", "ðŸ¨", "ðŸª", "ðŸ«", "ðŸ©", "ðŸ’’", "ðŸ›ï¸", "â›ª"
  ],
  "Objects": [
    "âŒš", "ðŸ“±", "ðŸ“²", "ðŸ’»", "âŒ¨ï¸", "ðŸ–¥ï¸", "ðŸ–¨ï¸", "ðŸ–±ï¸", "ðŸ–²ï¸", "ðŸ•¹ï¸", "ðŸ—œï¸", "ðŸ’½", "ðŸ’¾", "ðŸ’¿", "ðŸ“€", "ðŸ“¼",
    "ðŸ“·", "ðŸ“¸", "ðŸ“¹", "ðŸŽ¥", "ðŸ“½ï¸", "ðŸŽžï¸", "ðŸ“ž", "â˜Žï¸", "ðŸ“Ÿ", "ðŸ“ ", "ðŸ“º", "ðŸ“»", "ðŸŽ™ï¸", "ðŸŽšï¸", "ðŸŽ›ï¸", "ðŸ§­",
    "â±ï¸", "â²ï¸", "â°", "ðŸ•°ï¸", "âŒ›", "â³", "ðŸ“¡", "ðŸ”‹", "ðŸ”Œ", "ðŸ’¡", "ðŸ”¦", "ðŸ•¯ï¸", "ðŸª”", "ðŸ§¯", "ðŸ›¢ï¸", "ðŸ’¸",
    "ðŸ’µ", "ðŸ’´", "ðŸ’¶", "ðŸ’·", "ðŸª™", "ðŸ’°", "ðŸ’³", "ðŸ’Ž", "âš–ï¸", "ðŸªœ", "ðŸ§°", "ðŸ”§", "ðŸ”¨", "âš’ï¸", "ðŸ› ï¸", "â›ï¸",
    "ðŸ”©", "âš™ï¸", "ðŸªš", "ðŸ”«", "ðŸ§²", "ðŸ’£", "ðŸ§¨", "ðŸª“", "ðŸ”ª", "ðŸ—¡ï¸", "âš”ï¸", "ðŸ›¡ï¸", "ðŸš¬", "âš°ï¸", "ðŸª¦", "âš±ï¸"
  ],
  "Symbols": [
    "â¤ï¸", "ðŸ§¡", "ðŸ’›", "ðŸ’š", "ðŸ’™", "ðŸ’œ", "ðŸ–¤", "ðŸ¤", "ðŸ¤Ž", "ðŸ’”", "â£ï¸", "ðŸ’•", "ðŸ’ž", "ðŸ’“", "ðŸ’—", "ðŸ’–",
    "ðŸ’˜", "ðŸ’", "ðŸ’Ÿ", "â˜®ï¸", "âœï¸", "â˜ªï¸", "ðŸ•‰ï¸", "â˜¸ï¸", "âœ¡ï¸", "ðŸ”¯", "ðŸ•Ž", "â˜¯ï¸", "â˜¦ï¸", "ðŸ›", "â›Ž", "â™ˆ",
    "â™‰", "â™Š", "â™‹", "â™Œ", "â™", "â™Ž", "â™", "â™", "â™‘", "â™’", "â™“", "ðŸ†”", "âš›ï¸", "ðŸ‰‘", "â˜¢ï¸", "â˜£ï¸", "ðŸ“´", "ðŸ“³",
    "ðŸˆ¶", "ðŸˆš", "ðŸˆ¸", "ðŸˆº", "ðŸˆ·ï¸", "âœ´ï¸", "ðŸ†š", "ðŸ’®", "ðŸ‰", "ãŠ™ï¸", "ãŠ—ï¸", "ðŸˆ´", "ðŸˆµ", "ðŸˆ¹", "ðŸˆ²", "ðŸ…°ï¸",
    "ðŸ…±ï¸", "ðŸ†Ž", "ðŸ†‘", "ðŸ…¾ï¸", "ðŸ†˜", "âŒ", "â­•", "ðŸ›‘", "â›”", "ðŸ“›", "ðŸš«", "ðŸ’¯", "ðŸ’¢", "â™¨ï¸", "ðŸš·", "ðŸš¯"
  ]
};

interface EmojiPickerProps {
  isOpen: boolean;
  onClose: () => void;
  onEmojiSelect: (emoji: string) => void;
  selectedEmoji?: string;
}

export function EmojiPicker({ isOpen, onClose, onEmojiSelect, selectedEmoji }: EmojiPickerProps) {
  const [searchTerm, setSearchTerm] = useState("");
  const [selectedCategory, setSelectedCategory] = useState("Smileys & People");

  const filteredEmojis = useMemo(() => {
    if (!searchTerm) {
      return EMOJI_CATEGORIES[selectedCategory as keyof typeof EMOJI_CATEGORIES] || [];
    }

    // Search across all categories
    const allEmojis = Object.values(EMOJI_CATEGORIES).flat();
    return allEmojis.filter(emoji => {
      // Simple search - you could enhance this with emoji names/keywords
      return emoji.includes(searchTerm);
    });
  }, [searchTerm, selectedCategory]);

  const handleEmojiClick = (emoji: string) => {
    onEmojiSelect(emoji);
    onClose();
  };

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent className="max-w-md max-h-[80vh] bg-dark-surface border-dark-elevated">
        <DialogHeader className="flex flex-row items-center justify-between space-y-0 pb-4">
          <DialogTitle className="text-lg font-semibold text-text-primary">
            Choose an emoji
          </DialogTitle>
          <Button
            variant="ghost"
            size="sm"
            onClick={onClose}
            className="h-8 w-8 p-0 text-text-secondary hover:bg-dark-elevated"
            data-testid="button-close-emoji-picker"
          >
            <X className="h-4 w-4" />
          </Button>
        </DialogHeader>

        {/* Search Bar */}
        <div className="relative mb-4">
          <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-text-secondary" />
          <Input
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            placeholder="Search emojis..."
            className="pl-10 bg-dark-elevated border-text-secondary/20 !text-white placeholder:!text-gray-400"
            style={{ color: 'white' }}
            data-testid="input-emoji-search"
          />
        </div>

        {/* Category Tabs */}
        {!searchTerm && (
          <div className="flex flex-wrap gap-1 mb-4">
            {Object.keys(EMOJI_CATEGORIES).map((category) => (
              <button
                key={category}
                onClick={() => setSelectedCategory(category)}
                className={cn(
                  "px-3 py-1 text-xs rounded-full transition-colors",
                  selectedCategory === category
                    ? "bg-spotify text-dark-bg font-medium"
                    : "bg-dark-elevated text-text-secondary hover:bg-dark-elevated/80"
                )}
                data-testid={`button-category-${category.toLowerCase().replace(/\s+/g, '-')}`}
              >
                {category}
              </button>
            ))}
          </div>
        )}

        {/* Emoji Grid */}
        <div className="overflow-y-auto max-h-80">
          {searchTerm && (
            <p className="text-sm text-text-secondary mb-3">
              Search results for "{searchTerm}"
            </p>
          )}
          <div className="grid grid-cols-8 gap-2">
            {filteredEmojis.map((emoji, index) => (
              <button
                key={`${emoji}-${index}`}
                onClick={() => handleEmojiClick(emoji)}
                className={cn(
                  "p-2 text-xl hover:bg-dark-elevated rounded-lg transition-colors border-2 border-transparent",
                  selectedEmoji === emoji && "border-vibe-orange bg-dark-elevated"
                )}
                data-testid={`button-emoji-option-${emoji}`}
              >
                {emoji}
              </button>
            ))}
          </div>
          
          {filteredEmojis.length === 0 && searchTerm && (
            <div className="text-center py-8 text-text-secondary">
              <p>No emojis found for "{searchTerm}"</p>
              <p className="text-sm mt-1">Try a different search term</p>
            </div>
          )}
        </div>
      </DialogContent>
    </Dialog>
  );
}